# Configuration du Modèle de Prédiction de Pourboire
# Source: MinIO Parquet (bucket nyc-cleaned)

# ========================================
# Configuration MinIO
# ========================================
minio {
  bucketName = "nyc-cleaned"
  bucketName = ${?CLEANED_BUCKET_NAME}
  fileName = "yellow_tripdata_2025-08_cleaned.parquet"
  fileName = ${?FILE_NAME_BUCKET_FIRST_DEPOSIT}
}

# ========================================
# Configuration du Modèle Random Forest
# ========================================
model {
  name = "TipPredictionRandomForest"
  version = "2.0"
  
  # Hyperparamètres du Random Forest
  randomForest {
    numTrees = 100
    maxDepth = 10
    minInstancesPerNode = 5
    featureSubsetStrategy = "auto"
    impurity = "gini"
    seed = 42
  }
}

# ========================================
# Configuration des Données
# ========================================
data {
  # Split train/test
  trainRatio = 0.8
  testRatio = 0.2
  randomSeed = 42
  
  # Features utilisées pour la prédiction (14 features)
  features = [
    # Features originales du Parquet
    "fare_amount",
    "trip_distance",
    "passenger_count",
    "rate_code_id",
    "payment_type_id",
    "extra",
    "mta_tax",
    "tolls_amount",
    # Features dérivées (feature engineering)
    "pickup_hour",
    "trip_duration_minutes",
    # Features supplémentaires du Parquet
    "congestion_surcharge",
    "airport_fee",
    "cbd_congestion_fee",
    "improvement_surcharge"
  ]
  
  # Seuil pour définir un pourboire
  # Si tip_amount > tipThreshold, alors label = 1 (tip), sinon label = 0 (no tip)
  tipThreshold = 0.0
}

# ========================================
# Configuration de la Normalisation
# ========================================
preprocessing {
  # Normalisation des features
  standardScaler {
    withMean = true
    withStd = true
  }
  
  # Gestion des valeurs manquantes
  fillNullWith = 0.0
  
  # Filtres de nettoyage
  filters {
    minFareAmount = 0
    minTripDistance = 0
    minPassengerCount = 0
    maxTripDurationMinutes = 300
  }
}

# ========================================
# Configuration de l'Évaluation
# ========================================
evaluation {
  # Métriques à calculer
  metrics = [
    "accuracy",
    "precision",
    "recall",
    "f1",
    "auc",
    "areaUnderPR"
  ]
  
  # Afficher la matrice de confusion
  showConfusionMatrix = true
  
  # Afficher la distribution des prédictions
  showPredictionDistribution = true
}
